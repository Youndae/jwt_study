# 프로젝트 설명.

---

인프런 jwt 강의에서 postman만을 사용해 테스트 했으니   
html 파일을 만들어서 실제 프로젝트에 어떻게 적용이 되는지에 대한 테스트.   

---

# 강의와의 차이점

---

현재 시점에서 WebSecurityConfigurerAdapter는 Deprecated 상태이므로   
현 상황에 맞게 Adapter를 사용하지 않고 구현.
> 이 방법의 문제점
> > SecurityConfig에서 필터를 추가할때 각 필터에
> > authenticationManager()를 넣어주었는데 Adapter를 사용하지 않다보니
> > 여기서 오류가 발생함.   
> > 그래서 문제 해결로 Adapter에 들어가서 authenticationManager() 메소드를
> > SecurityConfig 하단에 작성해주는 방법으로 해결.
> > 근데 이건 1차원 적인 해결방법으로 보임.   
> > authenticationManager() 메소드를 호출하지 않거나 다르게 사용하는 방법으로
> > 변경하는 것이 좀 더 나은 방법이지 않나 싶음.
> > 일단 강의내용까지의 테스트에서는 정상적으로 작동.

---

# 테스트 전 체크사항.

---

1. html 페이지 연결 체크
2. 로그인 페이지에서 /login으로 데이터를 넘겨줄때 json을 사용.

---

# 테스트 사항

---

1. 로그인이 정상적으로 처리되는지 체크
2. 로그인 후 각 페이지로 접근시에 권한 문제에 대해 정상적으로 처리되는지 체크




로그인 처리 완료.
정상적인 로그인 처리가 되는것으로 보이나
토큰이 생성이 되지 않은 것인지
아니면 토큰이 헤더로 넘어오지 않은것인지 
헤더로 넘어온 토큰이 같이 넘어가지 않은 것인지
403발생함.
전체적으로 로그 찍어서 확인하기.


로그인 시 토큰 생성 후 정상적으로 리턴 될 시
ajax에서 페이지 넘기기 전에 토큰을 localStorage에 저장하도록 함.
여기서 문제점.
request.getHeader()는 localStorage를 체크하지 않아
Authorization을 가져오지 못함.
그럼 Header에 계속 넣어주는 방법을 택해야 하는것인지
아니면 localStorage에서 꺼내오는 방법이 있는지
아니면 Cokkie에 넣어 여기서 꺼내 사용할 것인지
방법 찾아봐야함.
그래서 man's Shop 열어서 security에서는 인증 처리를 어떻게 진행하는지
어디에 저장해뒀다가 어떻게 꺼내왔는지 체크해볼것.
principal.getName()으로 아이디를 꺼내왔는데
principal에 들어갈 때 어떻게 정보가 들어갔는지
이 정보는 localStorage인지 SessionStorage인지 Cokkie인지
확인이 필요.

일단 생각하는 대로 적어보면
로그인 처리 -> 토큰 생성 -> 리턴 -> 토큰 storage저장 -> 
권한 필요한 페이지 접근 시 storage에서 토큰 추출 -> 
토큰 검증 후 인증 처리.

이렇게 진행이 되어야 할 것 같은데 다 구현이 되어있는 상태이지만
토큰을 어디에 저장하고 어떻게 넘겨줘야 할지가 고민.
매번 헤더에 넣어서 넘겨준다 라는 개념으로는 부족한게 로그인을 해놓고
버튼이동이 아닌 주소 이동을 하는 경우 그럼 헤더에 담는 부분이 빠지기 때문에
문제가 발생할 수 있음.


페이지 접근 시
로컬 스토리지에 토큰이 있다면 해당 토큰을 요청헤더에 추가.
없다면 추가하지 않음.



man's Shop 프로젝트 로그인 시 개발자도구 Network에서 login 항목안에
Payload를 보면 formData가 모두 나와 아이디, 비밀번호, csrf 토큰 모두 노출되는 문제.
